(()=>{"use strict";class e{#e;constructor(e=["","","","","","","","",""]){this.#e=e}getTile(e,t){return this.#e[e+3*t]}setTile(t,r,n){const s=[...this.#e];return s[t+3*r]=n,new e(s)}get winner(){const e=function(e){const t=[[],[],[]],r=[[],[],[]],n=[[],[]];for(let s=0;s<3;s+=1)for(let i=0;i<3;i+=1){const o=e.getTile(s,i);t[i].push(o),r[s].push(o),s===i&&n[0].push(o),s+i===2&&n[1].push(o)}return[...t,...r,...n]}(this),t=["X","O"];for(let r=0;r<e.length;r+=1)for(let n=0;n<t.length;n+=1)if(e[r].every((e=>e===t[n])))return t[n];return null}get freeTiles(){const e=[];for(let t=0;t<3;t+=1)for(let r=0;r<3;r+=1)""===this.getTile(t,r)&&e.push({x:t,y:r});return e}get isFull(){return this.#e.every((e=>""!==e))}}const t=e,r={evaluateMove(e,t,r,n=0){const s="X"===r?"O":"X",i=t.setTile(e.x,e.y,e.marker);if(i.winner===r)return 0===n?2:1;if(i.winner===s)return-1;if(i.isFull)return 0;const o=[];for(let t=0;t<i.freeTiles.length;t+=1){const{x:a,y:l}=i.freeTiles[t],c={x:a,y:l,marker:"X"===e.marker?"O":"X"},d=this.evaluateMove(c,i,r,n+1);if(e.marker===s&&1===d)return 1;if(e.marker===r&&-1===d)return-1;o.push(d)}return o.includes(0)?0:e.marker===s?-1:1},comeUpWithMove(e,t){const r=[];for(let n=0;n<e.freeTiles.length;n+=1){const{x:s,y:i}=e.freeTiles[n];r.push({x:s,y:i,marker:t,priority:this.evaluateMove({x:s,y:i,marker:t},e,t)})}return function(e){for(let t=2;t>=-1;t-=1){const r=e.filter((e=>e.priority===t));if(r.length>0){const e=r[Math.floor(Math.random()*r.length)];return{x:e.x,y:e.y,marker:e.marker}}}return null}(r)}};class n{#t;#r;#n;#s;#i;#o;constructor({board:e=new t,players:r=[{name:"Player",marker:"X",isCpu:!1},{name:"Cpu",marker:"O",isCpu:!0}],scoreboard:n=[0,0],startingPlayer:s=0,playerIndex:i=0,tieCount:o=0}={}){this.#t=e,this.#r=r,this.#n=n,this.#s=s,this.#i=i,this.#o=o}get board(){return this.#t}get players(){return this.#r}get startingPlayer(){return this.#s}get playerIndex(){return this.#i}get tieCount(){return this.#o}getScore(e){return"Player"===e?this.#n[0]:this.#n[1]}playTurn(e,t){if(this.#t.winner||this.#t.isFull)return this;let s;s=this.#r[this.#i].isCpu?r.comeUpWithMove(this.#t,this.#r[this.#i].marker):{x:e,y:t,marker:this.#r[this.#i].marker};const i={};return i.board=this.#t.setTile(s.x,s.y,s.marker),i.scoreboard=this.#n,i.tieCount=this.#o,i.board.winner&&(i.scoreboard[this.#i]+=1),this.#t.winner||this.#t.isFull||(i.playerIndex=0===this.#i?1:0),i.board.isFull&&!i.board.winner&&(i.tieCount+=1),i.startingPlayer=this.#s,i.players=this.#r,new n(i)}reset(){const e={};return e.board=new t,e.players=this.#r,e.scoreboard=this.#n,e.startingPlayer=0===this.#s?1:0,e.playerIndex=e.startingPlayer,e.tieCount=this.#o,new n(e)}}const s=n;let i=[{position:"1",name:"WorldMangoTree",time:{minutes:0,seconds:41,centiSeconds:13}},{position:"2",name:"__xxX_Kromo_xx",time:{minutes:0,seconds:49,centiSeconds:57}},{position:"3",name:"LLLLL",time:{minutes:1,seconds:4,centiSeconds:52}},{position:"4",name:"HomingSlingshot12",time:{minutes:1,seconds:1,centiSeconds:24}}];const o={addEntries(...e){i=e.reduce(((e,t)=>e.concat(t)),i).sort((function(e,t){return e.time.minutes!==t.time.minutes?e.time.minutes-t.time.minutes:e.time.seconds!==t.time.seconds?e.time.seconds-t.time.seconds:e.time.centiSeconds!==t.time.centiSeconds?e.time.centiSeconds-t.time.centiSeconds:0})).map(((e,t)=>({...e,position:t+1})))},get entries(){return i},clear(){i=[]}};let a,l=0,c=0,d=0;function u(e){l+=1,100===l&&(l=0,c+=1,60===c&&(c=0,d+=1)),e(0===d?`${c}:${l}`:`${d}:${c}:${l}`)}const m={start(e){void 0!==a&&this.stop(),a=setInterval(u,10,e)},stop(){clearInterval(a);const e={minutes:d,seconds:c,centiSeconds:l};return l=0,c=0,d=0,e}};let p,y;function h(e){document.querySelector(".stopwatch").textContent=e}function g(){const e=document.querySelectorAll(".mark");for(let t=0;t<9;t+=1)e[t].textContent=p.board.getTile(t%3,Math.floor(t/3))}function b(){document.querySelector(".streak").textContent=`Streak: ${p.tieCount}`}function x(){function e(e){const t=document.createElement("tr"),r=document.createElement("td"),n=document.createElement("td"),s=document.createElement("td");t.appendChild(r),t.appendChild(n),t.appendChild(s),r.classList.add("position"),n.classList.add("name"),s.classList.add("time");const i=e.time.seconds<10?`0${e.time.seconds}`:e.time.seconds,o=e.time.centiSeconds<10?`0${e.time.centiSeconds}`:e.time.centiSeconds;return r.textContent=e.position,n.textContent=e.name,s.textContent=`${e.time.minutes}:${i}:${o}`,t}const t=document.querySelector(".leaderboard"),r=document.createElement("div"),n=document.createElement("h2"),s=document.createElement("table");null!==t&&t.remove(),r.appendChild(n),r.appendChild(s);for(let t=0;t<10&&t<o.entries.length;t+=1)s.appendChild(e(o.entries[t]));r.classList.add("leaderboard"),n.textContent="Leaderboard",document.querySelector(".content > div").appendChild(r)}function f(){(p.board.winner||p.board.isFull)&&(b(),1===p.getScore("Cpu")?(document.querySelector(".game-start").disabled=!1,document.querySelector(".nickname").disabled=!1,m.stop()):10===p.tieCount?function(){const e={name:document.querySelector(".nickname").value,time:m.stop()};o.addEntries(e),x(),document.querySelector(".game-start").disabled=!1,document.querySelector(".nickname").disabled=!1}():p=p.reset(),g())}const C=()=>{p.players[p.playerIndex].isCpu&&(p=p.playTurn(),g(),requestAnimationFrame((()=>{f(),requestAnimationFrame((()=>{p.players[p.playerIndex].isCpu?C():(g(),requestAnimationFrame((()=>{document.querySelector(".board").addEventListener("click",y,{once:!0})})))}))})))};y=e=>{if(!e.target.classList.contains("tile")&&!e.target.classList.contains("mark"))return void document.querySelector(".board").addEventListener("click",y,{once:!0});const t={x:e.target.classList.contains("tile")?+e.target.dataset.column:+e.target.parentNode.dataset.column,y:e.target.classList.contains("tile")?+e.target.dataset.row:+e.target.parentNode.dataset.row};p.players[p.playerIndex].isCpu||""!==p.board.getTile(t.x,t.y)?document.querySelector(".board").addEventListener("click",y,{once:!0}):(p=p.playTurn(t.x,t.y),g(),requestAnimationFrame((()=>{f(),requestAnimationFrame(C)})))},document.querySelector(".game-start").addEventListener("click",(()=>{p=new s,p.players[p.playerIndex].isCpu&&(p=p.playTurn()),document.querySelector(".board").addEventListener("click",y,{once:!0}),m.start(h),g(),b(),document.querySelector(".game-start").disabled=!0,document.querySelector(".nickname").disabled=!0})),window.addEventListener("load",(()=>{x()}))})();